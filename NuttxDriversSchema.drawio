<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:137.0) Gecko/20100101 Firefox/137.0" version="26.2.13" pages="5">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="BMI160">
    <mxGraphModel dx="2219" dy="1717" grid="0" gridSize="13" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Register driver in the File System*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;register_driver&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;path,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fops&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/*&amp;amp;g_bmi160fpos*/&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mode_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; mode,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;priv &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/*bmi160_dev_s*/&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-318" y="-760" width="389" height="115" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-7" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;g_bmi160fops &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;bmi160_open,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; /* open */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; bmi160_close,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* close */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;bmi160_read,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; /* read */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* write */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* seek */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;    bmi160_ioctl,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* ioctl */ &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-943" width="353" height="160" as="geometry" />
        </mxCell>
        <mxCell id="lok8ws-xfs92NpGrraoT-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-11" target="WIyWlLk6GJQsqaUBKTNV-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-11" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;bmi160_register&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;devpath,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-743" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RDKkUYRwnWEVyG1GKreG-8" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;bmi160_dev_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_SENSORS_BMI160_I2C&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;    FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;     &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; addr;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;  &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; freq;       &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#else&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;spi_dev_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;spi&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-1143" width="310" height="160" as="geometry" />
        </mxCell>
        <mxCell id="RDKkUYRwnWEVyG1GKreG-10" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;To implement at least ....&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;bmi160_open&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep); &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;bmi160_close&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;   static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;bmi160_read&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;            FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; len);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;bmi160_ioctl&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; cmd, &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;unsigned&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; arg);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-438" y="-1143" width="470" height="160" as="geometry" />
        </mxCell>
        <mxCell id="lok8ws-xfs92NpGrraoT-1" value="&lt;div align=&quot;left&quot;&gt;&lt;u&gt;Parametros necesarios para el alta del driver:&lt;/u&gt;&lt;br&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;path =&amp;gt; &quot;/dev/accel0&quot;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fops =&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;bmi160fops (tocará implementar las funciones) &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mode_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; mode =&amp;gt; inode privileges (mismos que para el cmd chmod)&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;priv =&amp;gt; instancia de &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;bmi160_dev_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(implica implementar &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c_master_s / spi_dev_s + i2c_fops (y sus funciones) &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=15;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-653" width="881" height="110" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ceq7ut0R8-0ltyFcsIzv" name="I2Cdriver">
    <mxGraphModel dx="1357" dy="1837" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="7BrDZMqGRWcAWwIqzSZP-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(255, 0, 0), rgb(119, 138, 145));&quot;&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c_driver_s { &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_PSEUDOFS_OPERAT   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;mutex_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; lock;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;//Mutual exclusion      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; crefs;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //# of open references &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;  bool&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; unlinked;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //True: driver=unlinked  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="38" y="-1122" width="365" height="160" as="geometry" />
        </mxCell>
        <mxCell id="7BrDZMqGRWcAWwIqzSZP-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* NO es una struct definition, es una&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;instancia de file_operations */&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;   struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;file_operations&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;g_i2cdrvr_fops &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_PSEUDOFS_OPERATIONS&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;i2cdrvr_open,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* open */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; i2cdrvr_close,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; /* close */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#else&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* open */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* close */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;i2cdrvr_read,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* read */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; i2cdrvr_write,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; /* write */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* seek */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; i2cdrvr_ioctl,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; /* ioctl */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* mmap */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;    NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* truncate */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* poll */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="535" y="-1122" width="435" height="381" as="geometry" />
        </mxCell>
        <mxCell id="7BrDZMqGRWcAWwIqzSZP-4" value="&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #859900;&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: #b58900;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;CONFIG_DISABLE_PSEUDOFS_OPERATIONS&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;i2cdrvr_open&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep);    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;i2cdrvr_close&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep);   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #859900;&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;i2cdrvr_read&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; buflen);     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt; static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;i2cdrvr_write&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; buflen);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;i2cdrvr_ioctl&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep,    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; cmd, &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;unsigned&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; arg);           &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="38" y="-950" width="470" height="220" as="geometry" />
        </mxCell>
        <mxCell id="hJbFsVmf1wALlW13_6vB-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Llama a la clase principal register_driver() */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_register&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; bus)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="38" y="-663" width="480" height="55" as="geometry" />
        </mxCell>
        <mxCell id="mS0uXqhvNsxPGNCJXv56-1" value="&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;I2C_driver&lt;/b&gt;: Es la &quot;clase abstracta&quot; de I2C, de la que heredan la clase I2Cmaster y I2Cslave. Añade counter of references y locks.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;i2c_register()&lt;/b&gt;: la struct i2c está vacía cuando se le pasa a la función ? diría que si .....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Las funciones &lt;b&gt;i2cdrvr_read&lt;/b&gt; y &lt;b&gt;i2cdrvr_write&lt;/b&gt; tienen una definción muy simple, pues no se va a llamar a estas funciones, ya que I2C es un protocolo y tocará implementar las funciones de file_operations en el device driver del hardware (sensor, ...) que conectemos mediante I2C. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Las funciones &lt;b&gt;i2cdrvr_open/close&lt;/b&gt; si tienen una función definida (i2cdrvr_open =&amp;gt; SETUP y i2cdrvr_close =&amp;gt; SHUTDOWN),&lt;/div&gt;&lt;div&gt;pero NO crean la struct file que representa un open file. El device file se creará cuando el sensor asociado llame a open(), para no abrir 2 files.&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;background-color: rgb(255, 255, 153);&quot;&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;Cuando/Desde donde se llama a estas funciones (&lt;/span&gt;&lt;/span&gt;i2cdrvr_open/close&lt;span style=&quot;background-color: rgb(255, 255, 153);&quot;&gt;&lt;span style=&quot;background-color: light-dark(#ffffff, var(--ge-dark-color, #121212));&quot;&gt;) ?&lt;/span&gt;&lt;/span&gt; El sensor driver llama a open/close ?? &lt;b&gt;PENDING&lt;/b&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;g_i2cdrvr_fops&lt;/b&gt; es una [static] instancia.&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="41" y="-572" width="1013" height="202" as="geometry" />
        </mxCell>
        <mxCell id="x5SNIDy2Qdg9Ix8WgeVO-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;register_driver&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;devName&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;g_i2cdrvr_fops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(211, 54, 130);&quot;&gt;666&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;priv &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/*i2c_driver_s*/&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="690" y="-692" width="280" height="76" as="geometry" />
        </mxCell>
        <mxCell id="x5SNIDy2Qdg9Ix8WgeVO-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hJbFsVmf1wALlW13_6vB-1" target="x5SNIDy2Qdg9Ix8WgeVO-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1006" y="-634" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="BzAR8ItBl61TNbMuLKc-" name="I2Cmaster">
    <mxGraphModel dx="5492" dy="6355" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="v0qmTJnK84-sELWR6PWf-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* The I2C lower half driver interface */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;transfer&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;  FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_msg_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;msgs, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; count);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_RESET                              &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;CODE &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;reset&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev);  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif        &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;setup&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev);  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;shutdown&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev)&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;} &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5758" width="473" height="208" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;frequency&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;address&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;addrlen&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3296" y="-5758" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_msg_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;frequency&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;addr&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;flags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt; FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;buffer&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;length&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; };&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3554" y="-5758" width="210" height="140" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-4" value="&lt;br&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;ops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//s&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;pecific implementation may&lt;/span&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;add additional, device specific&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; fields after the vtable. &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3296" y="-5647" width="296" height="120" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-5" value="&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;i2c_transfer_s &lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;i2c_msg_s&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;msgv&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #93a1a1;font-style: italic;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;msgc&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;;&lt;/span&gt; &lt;span style=&quot;color: #657b83;&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3577" y="-5608" width="260" height="75" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-6" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//estas 3 funciones se definen en nuttx/drivers/i2c/i2c_xxxx.c&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_writeread&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config,                                    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;wbuffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; wbuflen, FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;rbuffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; rbuflen);          &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_write&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_config_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen); &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_read&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config, FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen);       &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5510" width="1036" height="117" as="geometry" />
        </mxCell>
        <mxCell id="S4ZAn-DIevI1MzGfiiiq-1" value="&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_config_s&lt;/b&gt;: This structure contains the full state of I2C as needed for a specific transfer. It is passed to I2C methods so that I2C transfer may be&amp;nbsp; performed in a thread safe manner.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_msg_s&lt;/b&gt;: I2C transaction segment beginning with a START. A number of these can be transferred together to form an arbitrary sequence of write/read transfer to an I2C slave device.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_master_s&lt;/b&gt;: I2C private data.&amp;nbsp; This structure only defines the initial fields of the structure visible to the I2C client. The specific implementation may add additional, device specific fields after the vtable.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_transfer_s&lt;/b&gt;: This structure is used to communicate with the I2C character driver in order to perform IOCTL transfers.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&amp;gt;&amp;gt; &lt;b&gt;i2c_master_s&lt;/b&gt; apunta a &lt;b&gt;i2c_ops_s&lt;/b&gt; (transfer, reset, setup, shutdown), mientras que &lt;b&gt;i2c_driver_s&lt;/b&gt; apunta a &lt;b&gt;file_operations g_i2cdrv_fops&lt;/b&gt;.&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;stm32_i2cbus_initialize&lt;/b&gt; copia los datos de conf. guardados según el puerto y los devuelve en la struct i2c_master_s. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;NO me parece que inicialice nada&lt;/u&gt; .......&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Transfer: NBYTES, address mode (7-10bits), slave/receiver address, transfer direction (RD_WRN), Interrupts, DMA, Analog/Digital filters, START bit&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Reset: clear PE bit in I2C_CR1&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Setup: clocks, GPIOs, timing (TIMINGR), own address (if slave mode), stretching, set PE bit&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Shutdown: STOP bit, clear PE bit&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5276" width="1013" height="429" as="geometry" />
        </mxCell>
        <mxCell id="e5chffkP4uDMk-mZI0sD-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;No inicializa nada -no hay args,solo el port-&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;stm32_i2cbus_initialize&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; port) &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5360" width="480" height="55" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="A9oIVDMthQsQp1bT95zv" name="fs">
    <mxGraphModel dx="6319" dy="7682" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="kRoskdS9pLBbdyxuaAtI-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;   CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;open&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep); &lt;/span&gt;&lt;span style=&quot;color: #93a1a1;font-style: italic;&quot;&gt;//filep = i_node-&amp;gt;i_priv + flags + pos&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;       &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;close&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep);              &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;read&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen);       &lt;/span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;write&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen); &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;seek&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; offset, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; whence);                 &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;ioctl&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; cmd, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;unsigned&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; arg);                &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;mmap&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mm_map_entry_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;map);             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;truncate&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; length);                           &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp; /* The two structures need not be common after this point */                   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;poll&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;pollfd&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fds, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210); font-weight: bold;&quot;&gt;bool&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; setup);         &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4915" y="-6974" width="750" height="240" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;union&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode_ops_u &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Driver operations for inode */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_ops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_MOUNTPOINT            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;block_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_bops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mtd_dev_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_mtd&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;  &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mountpt_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_mops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_FS_NAMED_SEMAPHORES            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; nsem_inode_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i_nsem;         &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_PSEUDOFS_SOFTLINKS             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i_link;                        &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;  #endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4546" y="-6587" width="411" height="300" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* representation of an open file * /&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{                        &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;    int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_oflags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//Open mode flags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_pos&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//File position    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//Driver or file interface&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//Per file/driver private data     &lt;/span&gt;&lt;/div&gt;&lt;div&gt; &lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_priv&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//??&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; };  &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;           &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4915" y="-6718" width="358" height="173" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-4" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;Register a character driver inode&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;register_driver&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;path,  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fops,  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;    mode_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; mode, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;priv &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;user data&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-4544" y="-6718" width="407" height="95" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-5" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{                  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt; FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_parent&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_peer&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_child&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;int16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_crefs&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_flags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;   union&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode_ops_u&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;u&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//union&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt; ino_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_ino&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#if&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;defined&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_PSEUDOFS_FILE&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;i_size;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_PSEUDOFS_ATTRIBUTES&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* mode, uid,gid, .. */&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Driver private data */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_private&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//xxx_driver_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_name&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: rgb(211, 54, 130);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //dev/xx/yz&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4107" y="-6974" width="319" height="341" as="geometry" />
        </mxCell>
        <mxCell id="lAP1LnDce3iENeDrHdkq-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;A DIR is a container for an inode&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;reference and the path´s directory.&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;fs_dirent_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{          &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;fd_root&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;fd_path&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};   &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4915" y="-6507" width="310" height="116" as="geometry" />
        </mxCell>
        <mxCell id="duDk2nEikeWjtBVwbX7L-1" value="&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;register_driver&lt;/b&gt;: creates the inode and populates inode-&amp;gt;name, inode-&amp;gt;u.i_ops and inode-&amp;gt;i_private.&lt;br&gt;Estamos guardando los datos necesarios para cuando haya que crear el&amp;nbsp; device file, que no se creará&lt;/div&gt;&lt;div&gt;hasta que se llame por primera vez a open(/dev/xyz). Un open file no es más que una struct file.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;gt;&amp;gt;&lt;b&gt; open(/dev/xyz)&lt;/b&gt;: find(/dev/xyz) in inode-&amp;gt;&lt;b&gt;i_name&lt;/b&gt;: if(true) return &lt;b&gt;fd&lt;/b&gt;, else &lt;u&gt;create new file and return fd&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt;&lt;font&gt;In the context of Linux kernel development, the &lt;code&gt;inode-&amp;gt;i_private&lt;/code&gt; field is used to store file system-specific private data.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&amp;gt;&amp;gt; No confundir &lt;b&gt;file &lt;/b&gt;con &lt;b&gt;FILE &lt;/b&gt;(file_struct&lt;b&gt; &lt;/b&gt;for STREAMS): A &lt;/font&gt;&lt;code class=&quot;literal&quot;&gt;file&lt;/code&gt; has nothing to do with the &lt;code class=&quot;literal&quot;&gt;FILE&lt;/code&gt;s of user-space programs.&amp;nbsp;&lt;/div&gt;&lt;div&gt;A &lt;b&gt;&lt;code class=&quot;literal&quot;&gt;FILE&lt;/code&gt; &lt;/b&gt;is defined in the C library and never appears in kernel code. A &lt;code class=&quot;literal&quot;&gt;struct file&lt;/code&gt;, on the other hand,&lt;br&gt;is a kernel structure that never appears in user programs. &lt;code class=&quot;literal&quot;&gt;struct file&lt;/code&gt;, defined in &lt;code class=&quot;literal&quot;&gt;&amp;lt;linux/fs.h&amp;gt;&lt;/code&gt;&lt;/div&gt;&lt;div&gt;https://www.oreilly.com/library/view/linux-device-drivers/0596000081/ch03s04.html&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="-4931" y="-6269" width="841" height="308" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="UR_Vu6l7ylUV9EF5J6kH" name="STM32_I2C">
    <mxGraphModel dx="1417" dy="1697" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="xcSjnpkw9AxS-IWghPuX-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C interface */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; STATIC &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;stm32_i2c_ops &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; .transfer &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_i2c_transfer&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;    #ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_RESET            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; , .reset &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_i2c_reset&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;    #endif&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};                           &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="590" y="-820" width="370" height="140" as="geometry" />
        </mxCell>
        <mxCell id="xcSjnpkw9AxS-IWghPuX-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C Device hardware configuration */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;STATIC struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_config_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; base;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* I2C base address */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; clk_bit;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Clock enable bit */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; reset_bit;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Reset bit */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; scl_pin;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* GPIO config for SCL as SCL */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; sda_pin;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* GPIO config for SDA as SDA */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_POLLED&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; ev_irq;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Event IRQ */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; er_irq;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* Error IRQ */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="590" y="-1110" width="460" height="240" as="geometry" />
        </mxCell>
        <mxCell id="H0LIsPvyKAJz_NdIQdW4-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C Device Private Data */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;STATIC struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_i2c_priv_s {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp; /* Standard I2C operations */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;ops;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp; /* Port configuration */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; refs;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Reference count */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;mutex_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; lock;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Mutual exclusion lock */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_POLLED&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;sem_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; sem_isr;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Interrupt wait semaphore */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif                   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;volatile&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; intstate;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Interrupt handshake */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;(see enum stm32_intstate_e) */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; msgc;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Message count */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_msg_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;msgv;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Message list */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;ptr;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current message buffer */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; frequency;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current I2C frequency */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; dcnt;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current message length */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; flags;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current message flags&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp; /* I2C trace support */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_TRACE&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; tndx;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* Trace array index */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;clock_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; start_time;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* Time when the trace was started */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp; /* The actual trace data */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_trace_s trace[CONFIG_I2C_NTRACE];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif };&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=4;" vertex="1" parent="1">
          <mxGeometry x="50" y="-1120" width="510" height="540" as="geometry" />
        </mxCell>
        <mxCell id="DXYhraj3M6U5t9TE3zii-2" value="Las 3 struct son static (privates) definidas en stm32_i2c.c" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="610" y="-660" width="360" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
