<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:139.0) Gecko/20100101 Firefox/139.0" version="27.1.5" pages="6">
  <diagram id="C5RBs43oDa-KdzZeNtuy" name="BMI160">
    <mxGraphModel dx="2184" dy="1679" grid="0" gridSize="13" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-1" parent="WIyWlLk6GJQsqaUBKTNV-0" />
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Register driver in the File System*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;register_driver&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;path,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fops&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/*&amp;amp;g_bmi160fpos*/&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mode_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; mode,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;priv &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/*bmi160_dev_s*/&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-318" y="-760" width="389" height="115" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-7" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;g_bmi160fops &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;bmi160_open,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; /* open */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; bmi160_close,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* close */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;bmi160_read,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; /* read */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* write */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* seek */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;    bmi160_ioctl,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* ioctl */ &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-943" width="353" height="160" as="geometry" />
        </mxCell>
        <mxCell id="lok8ws-xfs92NpGrraoT-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="WIyWlLk6GJQsqaUBKTNV-1" source="WIyWlLk6GJQsqaUBKTNV-11" target="WIyWlLk6GJQsqaUBKTNV-3" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WIyWlLk6GJQsqaUBKTNV-11" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;bmi160_register&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;devpath,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-743" width="380" height="60" as="geometry" />
        </mxCell>
        <mxCell id="RDKkUYRwnWEVyG1GKreG-8" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;bmi160_dev_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_SENSORS_BMI160_I2C&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;    FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;     &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; addr;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp;  &amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; freq;       &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#else&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;spi_dev_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;spi&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-1143" width="310" height="160" as="geometry" />
        </mxCell>
        <mxCell id="RDKkUYRwnWEVyG1GKreG-10" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;To implement at least ....&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;bmi160_open&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep); &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;bmi160_close&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;   static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;bmi160_read&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;            FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; len);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;bmi160_ioctl&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;filep,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; cmd, &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;unsigned&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; arg);&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-438" y="-1143" width="470" height="160" as="geometry" />
        </mxCell>
        <mxCell id="lok8ws-xfs92NpGrraoT-1" value="&lt;div align=&quot;left&quot;&gt;&lt;u&gt;Parametros necesarios para el alta del driver:&lt;/u&gt;&lt;br&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;path =&amp;gt; &quot;/dev/accel0&quot;&lt;br&gt;&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fops =&amp;gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;bmi160fops (tocará implementar las funciones) &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mode_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; mode =&amp;gt; inode privileges (mismos que para el cmd chmod)&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;priv =&amp;gt; instancia de &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;bmi160_dev_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(implica implementar &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c_master_s / spi_dev_s + i2c_fops (y sus funciones)&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;br&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;b&gt;Importante&lt;/b&gt;:&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;gt;&amp;gt; Al registrar el driver, el pasamos el bus que vamos a utilizar la comunicación. Así la información de nuestro driver I2C se guarda en bmi160_dev_s para cuando haya que llamar a file_operations.&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;gt;&amp;gt; bmi160_open/close/read/write solo actuan a nivel del sensor, no gestionan nada del I2C driver.&amp;nbsp;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;Esto es igual para todos los sensores. Ni siquiera llaman a I2C_open/close/....&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div align=&quot;left&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=15;" parent="WIyWlLk6GJQsqaUBKTNV-1" vertex="1">
          <mxGeometry x="-798" y="-619" width="881" height="283" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="ceq7ut0R8-0ltyFcsIzv" name="I2Cdriver">
    <mxGraphModel dx="1628" dy="1781" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="7BrDZMqGRWcAWwIqzSZP-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: light-dark(rgb(255, 0, 0), rgb(119, 138, 145));&quot;&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c_driver_s { &lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_PSEUDOFS_OPERAT   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;mutex_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; lock;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;//Mutual exclusion      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; crefs;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //# of open references &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;  bool&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; unlinked;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //True: driver=unlinked  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="38" y="-1122" width="365" height="160" as="geometry" />
        </mxCell>
        <mxCell id="7BrDZMqGRWcAWwIqzSZP-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* NO es una struct definition, es una&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;instancia de file_operations */&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;   struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;g_i2cdrvr_fops &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_PSEUDOFS_OPERATIONS&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;i2cdrvr_open,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* open */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; i2cdrvr_close,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; /* close */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#else&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* open */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* close */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;i2cdrvr_read,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp;/* read */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; i2cdrvr_write,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; /* write */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* seek */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; i2cdrvr_ioctl,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; /* ioctl */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* mmap */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;    NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;/* truncate */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;NULL&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; /* poll */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="535" y="-1122" width="435" height="381" as="geometry" />
        </mxCell>
        <mxCell id="7BrDZMqGRWcAWwIqzSZP-4" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* The I2C upper half driver interface */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_PSEUDOFS_OPERATIONS&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2cdrvr_open&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep);    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2cdrvr_close&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep);   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2cdrvr_read&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen);     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2cdrvr_write&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2cdrvr_ioctl&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; file &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep,    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; cmd, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;unsigned&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; arg);           &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="38" y="-950" width="470" height="237" as="geometry" />
        </mxCell>
        <mxCell id="hJbFsVmf1wALlW13_6vB-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Llama a la clase principal register_driver() */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_register&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; bus)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="38" y="-663" width="480" height="55" as="geometry" />
        </mxCell>
        <mxCell id="mS0uXqhvNsxPGNCJXv56-1" value="&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;I2C_driver_s&lt;/b&gt;: Se crea esta clase por encima de I2C_masters_s como una clase abstracta de I2C, de la que heredanlas clases&lt;/div&gt;&lt;div&gt;I2Cmaster y I2Cslave. Añade counter of references y locks. Si pasaramos de I2C_slave_s nos la podríamos ahorrar y combinar I2C_driver_s con I2C_master_s. El tema de los references y locks es porque el driver permite multiples instancias (compartir el I2C bus con varias sensores).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;i2c_register()&lt;/b&gt;: Creates and registers the I2C character driver. la struct i2c está vacía cuando se le pasa a la función ? diría que si .....&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Las funciones &lt;b&gt;i2cdrvr_open,&amp;nbsp;&lt;/b&gt;&lt;b&gt;i2cdrvr_close,&amp;nbsp;&lt;/b&gt;&lt;b&gt;i2cdrvr_read&lt;/b&gt; y &lt;b&gt;i2cdrvr_write&amp;nbsp;&lt;/b&gt;están definidas, pero no hay ninguna llamada a ninguna de las&amp;nbsp; funciones. Entiendo que al final se llama a las funciones del driver I2C definidas a nivel de la board.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;g_i2cdrvr_fops&lt;/b&gt; es una [static] instancia, tampoco creo que se utilice nunca.&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="41" y="-572" width="1013" height="197" as="geometry" />
        </mxCell>
        <mxCell id="x5SNIDy2Qdg9Ix8WgeVO-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;register_driver&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;devName&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;g_i2cdrvr_fops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;color: rgb(211, 54, 130);&quot;&gt;666&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;priv &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/*i2c_driver_s*/&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;glass=0;strokeWidth=1;shadow=0;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="690" y="-692" width="280" height="76" as="geometry" />
        </mxCell>
        <mxCell id="x5SNIDy2Qdg9Ix8WgeVO-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" parent="1" source="hJbFsVmf1wALlW13_6vB-1" target="x5SNIDy2Qdg9Ix8WgeVO-3" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1006" y="-634" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="BzAR8ItBl61TNbMuLKc-" name="I2Cmaster">
    <mxGraphModel grid="0" page="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="v0qmTJnK84-sELWR6PWf-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* The I2C lower half driver interface */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;transfer&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;  FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_msg_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;msgs, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; count);&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_RESET                              &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;CODE &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;reset&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev);  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif        &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;setup&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev);  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;shutdown&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev)&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;} &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5758" width="473" height="208" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;frequency&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;address&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;addrlen&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3296" y="-5758" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_msg_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;frequency&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;addr&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;flags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt; FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;buffer&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;length&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; };&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3554" y="-5758" width="210" height="140" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-4" value="&lt;br&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;ops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//s&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;pecific implementation may&lt;/span&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;add additional, device specific&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; fields after the vtable. &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3296" y="-5647" width="296" height="120" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-5" value="&lt;div style=&quot;color: #657b83;background-color: #fdf6e3;font-family: Consolas, &#39;Courier New&#39;, monospace;font-weight: normal;font-size: 15px;line-height: 20px;white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;i2c_transfer_s &lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #586e75;font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;i2c_msg_s&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #859900;&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;msgv&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;color: #93a1a1;font-style: italic;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: #cb4b16;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: #268bd2;&quot;&gt;msgc&lt;/span&gt;&lt;span style=&quot;color: #657b83;&quot;&gt;;&lt;/span&gt; &lt;span style=&quot;color: #657b83;&quot;&gt;};&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-3577" y="-5608" width="260" height="75" as="geometry" />
        </mxCell>
        <mxCell id="v0qmTJnK84-sELWR6PWf-6" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//estas 3 funciones se definen en nuttx/drivers/i2c/i2c_xxxx.c (xxx.c=read.c, write.c, writeread.c)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_writeread&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_master_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config,                                    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;wbuffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; wbuflen, FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;rbuffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; rbuflen);          &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_write&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_config_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen); &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i2c_read&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(FAR &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;dev, &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_config_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config, &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen);       &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;align=center;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5510" width="1036" height="117" as="geometry" />
        </mxCell>
        <mxCell id="S4ZAn-DIevI1MzGfiiiq-1" value="&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_config_s&lt;/b&gt;: This structure contains the full state of I2C as needed for a specific transfer. It is passed to I2C methods so that I2C transfer&lt;/div&gt;&lt;div&gt;&amp;nbsp;may be performed in a thread safe manner. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;i&gt;opción 1&lt;/i&gt;&lt;b&gt;: address &lt;/b&gt;is not the device @, but the register @ to read from. addrlen is the register´s size (8-16-32 bits)&lt;/div&gt;&lt;div&gt;&lt;i&gt;opción 2&lt;/i&gt;: &lt;b&gt;address &lt;/b&gt;is the device @, addrlen is 7 or 10 bits&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_master_s&lt;/b&gt;: I2C private data.&amp;nbsp; This structure &lt;br&gt;only defines the initial fields of the structure visible to the I2C &lt;br&gt;client. The specific implementation may add additional, device specific &lt;br&gt;fields after the vtable.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_msg_s&lt;/b&gt;: I2C transaction segment beginning with a START. A number of these can be transferred together to form an arbitrary sequence of write/read transfer&lt;/div&gt;&lt;div&gt;&amp;nbsp;to an I2C slave device. We use flags to advice I2C about the transaction type (Read/Write)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;struct i2c_transfer_s&lt;/b&gt;: This structure is used to communicate with the I2C character driver to perform IOCTL transfers.&amp;nbsp;&lt;u&gt;NO se utiliza en el driver stm32_i2c_v2.c.&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&amp;gt;&amp;gt; &lt;b&gt;i2c_master_s&lt;/b&gt; apunta a &lt;b&gt;i2c_ops_s&lt;/b&gt; (transfer, reset, setup, shutdown), mientras que &lt;b&gt;i2c_driver_s&lt;/b&gt; apunta a &lt;b&gt;file_operations g_i2cdrv_fops&lt;/b&gt;.&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;stm32_i2cbus_initialize&lt;/b&gt; copia los datos de conf. guardados según el puerto y los devuelve en la struct i2c_master_s. &lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;NO me parece que inicialice nada&lt;/u&gt; .......&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Transfer: NBYTES, address mode (7-10bits), slave/receiver address, transfer direction (RD_WRN), Interrupts, DMA, Analog/Digital filters, START bit&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Reset: clear PE bit in I2C_CR1&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Setup: clocks, GPIOs, timing (TIMINGR), own address (if slave mode), stretching, set PE bit&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt; Shutdown: STOP bit, clear PE bit&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5276" width="1184" height="429" as="geometry" />
        </mxCell>
        <mxCell id="e5chffkP4uDMk-mZI0sD-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;No inicializa nada -no hay args,solo el port-&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_master_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;stm32_i2cbus_initialize&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; port) &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4075" y="-5360" width="480" height="55" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="A9oIVDMthQsQp1bT95zv" name="fs">
    <mxGraphModel grid="0" page="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="kRoskdS9pLBbdyxuaAtI-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations {&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;   CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;open&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep); &lt;/span&gt;&lt;span style=&quot;color: #93a1a1;font-style: italic;&quot;&gt;//filep = i_node-&amp;gt;i_priv + flags + pos&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;       &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;close&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep);              &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;read&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen);       &lt;/span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;ssize_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;write&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;buffer, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; buflen); &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;seek&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; offset, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; whence);                 &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;ioctl&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; cmd, &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;unsigned&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;long&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; arg);                &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;mmap&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mm_map_entry_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;map);             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;truncate&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; length);                           &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp; /* The two structures need not be common after this point */                   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CODE&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; (&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;poll&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;)(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;filep, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;pollfd&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fds, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210); font-weight: bold;&quot;&gt;bool&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; setup);         &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4915" y="-6974" width="750" height="240" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;union&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode_ops_u &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Driver operations for inode */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_ops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_DISABLE_MOUNTPOINT            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;block_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_bops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mtd_dev_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_mtd&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;  &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mountpt_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_mops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_FS_NAMED_SEMAPHORES            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; nsem_inode_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i_nsem;         &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_PSEUDOFS_SOFTLINKS             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i_link;                        &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;  #endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;}&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4576" y="-6607" width="411" height="300" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-3" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Open file representation * /&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{                     &lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_oflags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//Open mode flags&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;off_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_pos&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//File position  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //Driver or file interface&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt; FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;     &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;   //Per file/driver private data   &lt;/span&gt;&lt;/div&gt;&lt;div&gt; &lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;f_priv&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//??&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; };  &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;         &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4915" y="-6718" width="320" height="173" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-4" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;Register a character driver inode&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;register_driver&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;path, &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;file_operations&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;fops,  &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;mode_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; mode, &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;priv &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;//&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;user data&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;) &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;" parent="1" vertex="1">
          <mxGeometry x="-4536" y="-6718" width="371" height="95" as="geometry" />
        </mxCell>
        <mxCell id="kRoskdS9pLBbdyxuaAtI-5" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{                  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt; FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_parent&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_peer&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_child&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;int16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_crefs&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_flags&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;   union&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode_ops_u&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;u&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//union&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt; ino_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_ino&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#if&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;defined&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_PSEUDOFS_FILE&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;size_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;i_size;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_PSEUDOFS_ATTRIBUTES&lt;/span&gt;&lt;/div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* mode, uid,gid, .. */&lt;/span&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Driver private data */&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;void&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_private&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//xxx_driver_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;i_name&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;color: rgb(211, 54, 130);&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;] &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; //dev/xx/yz&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4107" y="-6974" width="319" height="341" as="geometry" />
        </mxCell>
        <mxCell id="lAP1LnDce3iENeDrHdkq-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;A DIR is a container for an inode&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;reference and the path´s directory.&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;fs_dirent_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{          &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;inode&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;fd_root&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;FAR&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;char&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;fd_path&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};   &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=8;" parent="1" vertex="1">
          <mxGeometry x="-4915" y="-6507" width="310" height="116" as="geometry" />
        </mxCell>
        <mxCell id="duDk2nEikeWjtBVwbX7L-1" value="&lt;div&gt;&amp;gt;&amp;gt; &lt;b&gt;register_driver&lt;/b&gt;: creates the inode and populates inode-&amp;gt;name, inode-&amp;gt;u.i_ops and inode-&amp;gt;i_private.&lt;br&gt;Estamos guardando los datos necesarios para cuando haya que crear el&amp;nbsp; device file, que no se creará&lt;/div&gt;&lt;div&gt;hasta que se llame por primera vez a open(/dev/xyz). Un open file no es más que una struct file.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&amp;gt;&amp;gt;&lt;b&gt; open(/dev/xyz)&lt;/b&gt;: find(/dev/xyz) in inode-&amp;gt;&lt;b&gt;i_name&lt;/b&gt;: if(true) return &lt;b&gt;fd&lt;/b&gt;, else &lt;u&gt;create new file and return fd&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&amp;gt;&amp;gt;&amp;nbsp;&lt;font&gt;In the context of Linux kernel development, the &lt;code&gt;inode-&amp;gt;i_private&lt;/code&gt; field is used to store file system-specific private data.&lt;/font&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;font&gt;&amp;gt;&amp;gt; No confundir &lt;b&gt;file &lt;/b&gt;con &lt;b&gt;FILE &lt;/b&gt;(file_struct&lt;b&gt; &lt;/b&gt;for STREAMS): A &lt;/font&gt;&lt;code class=&quot;literal&quot;&gt;file&lt;/code&gt; has nothing to do with the &lt;code class=&quot;literal&quot;&gt;FILE&lt;/code&gt;s of user-space programs.&amp;nbsp;&lt;/div&gt;&lt;div&gt;A &lt;b&gt;&lt;code class=&quot;literal&quot;&gt;FILE&lt;/code&gt; &lt;/b&gt;is defined in the C library and never appears in kernel code. A &lt;code class=&quot;literal&quot;&gt;struct file&lt;/code&gt;, on the other hand,&lt;br&gt;is a kernel structure that never appears in user programs. &lt;code class=&quot;literal&quot;&gt;struct file&lt;/code&gt;, defined in &lt;code class=&quot;literal&quot;&gt;&amp;lt;linux/fs.h&amp;gt;&lt;/code&gt;&lt;/div&gt;&lt;div&gt;https://www.oreilly.com/library/view/linux-device-drivers/0596000081/ch03s04.html&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;u&gt;&lt;br&gt;&lt;/u&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;br&gt;&lt;/div&gt;&lt;br&gt;&lt;/div&gt;" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=15;" parent="1" vertex="1">
          <mxGeometry x="-4931" y="-6269" width="841" height="308" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="UR_Vu6l7ylUV9EF5J6kH" name="STM32_I2C">
    <mxGraphModel dx="1357" dy="1679" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="xcSjnpkw9AxS-IWghPuX-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C Device instance */&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_inst_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;ops&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;    &lt;/span&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_priv_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;priv&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;;&lt;/span&gt; &lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="590" y="-850" width="330" height="100" as="geometry" />
        </mxCell>
        <mxCell id="xcSjnpkw9AxS-IWghPuX-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C Device hardware configuration */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;static struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_config_s&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; {            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; base;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* I2C base address */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;  &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; clk_bit;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Clock enable bit */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; reset_bit;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Reset bit */   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; scl_pin;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* GPIO config for SCL as SCL */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; sda_pin;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* GPIO config for SDA as SDA */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_POLLED                   &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; ev_irq;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Event IRQ */    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; er_irq;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* Error IRQ */    &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};                                  &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="590" y="-1110" width="460" height="240" as="geometry" />
        </mxCell>
        <mxCell id="H0LIsPvyKAJz_NdIQdW4-1" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C Device Private Data */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;STATIC struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_priv_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* Port configuration */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;const&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;stm32_i2c_config_s &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;config;&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; refs;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Reference count */          &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;mutex_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; lock;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Mutual exclusion lock */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifndef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_POLLED                       &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;   sem_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; sem_isr;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Interrupt wait semaphore */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif                                          &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;volatile&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; color: rgb(234, 107, 102);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;intstate;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;        /* Interrupt handshake &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;(see stm32_intstate_e) */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;font-weight: bold; color: rgb(234, 107, 102);&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;msgc;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Message count */      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;  &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(234, 107, 102);&quot;&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;i2c_msg_s &lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;msgv;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Message list */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp;  &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint8_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;*&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;ptr;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current message buffer */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;      uint32_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; frequency;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current I2C frequency */&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; dcnt;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current message length */ &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;uint16_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; flags;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; /* Current message flags &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;     /* I2C trace support */                             &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_TRACE                        &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;int&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; tndx;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;&amp;nbsp;/* Trace array index */      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;         clock_t&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; start_time;&lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;//Time since trace started  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* The actual trace data */            &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&amp;nbsp; &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;    struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_trace_s trace[CONFIG_I2C_NTRACE];&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif };                                       &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=4;" parent="1" vertex="1">
          <mxGeometry x="50" y="-1120" width="490" height="500" as="geometry" />
        </mxCell>
        <mxCell id="DXYhraj3M6U5t9TE3zii-2" value="&amp;gt;&amp;gt; Las 3 struct son static (privates) definidas en stm32_i2c_v2.c para la STM32F3Discovery" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=14;" parent="1" vertex="1">
          <mxGeometry x="100" y="-510" width="1020" height="70" as="geometry" />
        </mxCell>
        <mxCell id="30C8NDsfgj4diPt_NSyI-2" value="&lt;div style=&quot;color: rgb(101, 123, 131); background-color: rgb(253, 246, 227); font-family: Consolas, &amp;quot;Courier New&amp;quot;, monospace; font-weight: normal; font-size: 15px; line-height: 20px; white-space: pre;&quot;&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(147, 161, 161); font-style: italic;&quot;&gt;/* I2C interface (i2_master.h)*/&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt; static &lt;/span&gt;&lt;span style=&quot;color: rgb(88, 110, 117); font-weight: bold;&quot;&gt;struct&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(203, 75, 22);&quot;&gt;i2c_ops_s &lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;stm32_i2c_ops &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;{  &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;.transfer &lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_i2c_transfer,&lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;    #ifdef&lt;/span&gt;&lt;span style=&quot;color: rgb(181, 137, 0);&quot;&gt; &lt;/span&gt;&lt;span style=&quot;color: rgb(38, 139, 210);&quot;&gt;CONFIG_I2C_RESET                 &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;.reset &amp;nbsp;&lt;/span&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;=&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt; stm32_i2c_reset      &lt;/span&gt;&lt;/div&gt;&lt;div&gt;&lt;span style=&quot;color: rgb(133, 153, 0);&quot;&gt;#endif&lt;/span&gt;&lt;span style=&quot;color: rgb(101, 123, 131);&quot;&gt;};                           &lt;/span&gt;&lt;/div&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="590" y="-730" width="370" height="140" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="_NK67Tlh-VQzG9f9iONZ" name="Initialization Sequence">
    <mxGraphModel dx="2828" dy="482" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-7" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-10" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-12" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-11">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-14" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-15" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-17" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-16">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-19" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-47" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-5" value="__start()" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-1246" y="35" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-6" value="stm32_clockconfig()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1152" y="141" width="120" height="35" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-8" value="&lt;p&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/NUTTX/NuttX+Initialization+Sequence&quot;&gt;https://cwiki.apache.org/confluence/display/NUTTX/NuttX+Initialization+Sequence&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;PRIMER NIVEL&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;[1] stm32_clockconfig()&lt;/b&gt;&amp;nbsp;[stm32_rcc.c]:&amp;nbsp;Initialize the PLLs and peripheral clocking needed by the board&amp;nbsp;based on the values in board.h + enable peripheral clocking according to the NuttX configuration file.&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;[2]&lt;/b&gt;&amp;nbsp;&lt;b&gt;stm32_lowsetup()&lt;/b&gt; [stm32_lowsetup.c]&amp;nbsp;Enable the console USART and configure GPIO pins needed for rx/tx.&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;[3]&lt;/b&gt;&amp;nbsp;&lt;b&gt;stm32_gpioinit()&lt;/b&gt; [stm32_gpio.c]&amp;nbsp;Perform any GPIO remapping that is needed for some boards.&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;[4]&lt;/b&gt;&amp;nbsp;&lt;b&gt;itm_syslog_initialize()&lt;/b&gt; [] Perform ARMv7-M ITM SYSLOG initialization&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;[5]&amp;nbsp;stm32_boardinitialize()&lt;/b&gt; [stm32_start.c] Board specific logic is Initialized&lt;/p&gt;&lt;p&gt;&lt;b&gt;SEGUNDO NIVEL&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&amp;gt;&amp;nbsp;&lt;b&gt;up_initialize()&lt;/b&gt; [arm_initialize.c] Handle CPU specific details of running the OS: ISR, clocks, register drivers.&amp;nbsp;All ARM-based MCUs share a common &lt;code&gt;up_initialize()&lt;/code&gt; implementation provided at &lt;code&gt;nuttx/arch/arm/src/common/up_initialize.c&lt;/code&gt;.&lt;br&gt; The operations perform by this common ARM initialization will, however,&lt;br&gt;call into facilities provided by the particular ARM chip&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;drivers_initialize()&lt;/b&gt; [drivers_initialize.c] Listado de if defined-endif para inicializar devices en función del .config&lt;/p&gt;&lt;p&gt;&amp;gt;&amp;nbsp;&lt;b&gt;nx_bringup()&lt;/b&gt; [nx_start.c]&amp;nbsp;&amp;nbsp;It starts all of the required threads and tasks needed to bring up the system. Hay un bringup a nivel CPU y otro a nivel board.&lt;/p&gt;&lt;p&gt;&amp;gt;&amp;nbsp;&lt;b&gt;nx_start_application()&lt;/b&gt; [nx_bringup.c] Launches the application either by creating a task for it or executing a program from a filesystem after mounting it.&lt;/p&gt;&lt;p&gt;&lt;b&gt;&amp;gt;&amp;nbsp;board_late_initialize()&lt;/b&gt; [stm32_boot.c]&amp;nbsp;is a last-minute, board-specific initialization,&amp;nbsp;an ideal place to do board-specific initialization steps that &lt;br&gt;depend on having a fully initialized OS such as memory allocations, &lt;br&gt;initialization of complex device drivers, mounting of file systems, etc.&lt;/p&gt;&lt;p&gt;&amp;gt; &lt;b&gt;stm32_bringup()&lt;/b&gt; [stm32_bringup.c] Hay 2 archivos con el mismo nombre en diferentes rutas: (1) Perform &lt;u&gt;architecture-specific&lt;/u&gt; initialization (2)&amp;nbsp;Perform &lt;u&gt;board-specific&lt;/u&gt; initialization.&amp;nbsp;Listado de if defined-endif para inicializar devices en función del .config&lt;/p&gt;&lt;p&gt;&amp;gt; Los 2 archivos donde creo que habría que inicializar nuestros drivers sonnuttx/drivers/drivers_initialize.c (menos frecuente) y nuttx/boards/arm/stm32/stm32f4discovery/src/stm32_bringup.c&amp;nbsp;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="-1626" y="520" width="960" height="778" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-13" value="stm32_gpioinit()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1002" y="141" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-16" value="itm_syslog_initialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-878" y="141" width="120" height="35" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-23" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-18" target="A2ZbU5LwQxJ9MIYdX8El-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-18" target="A2ZbU5LwQxJ9MIYdX8El-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-26" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-18" target="A2ZbU5LwQxJ9MIYdX8El-25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-28" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-18" target="A2ZbU5LwQxJ9MIYdX8El-27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-31" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-18" target="A2ZbU5LwQxJ9MIYdX8El-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-18" value="stm32_boardinitialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-734" y="140" width="130" height="35" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-34" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-20" target="A2ZbU5LwQxJ9MIYdX8El-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-41" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-20" target="A2ZbU5LwQxJ9MIYdX8El-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-20" value="nx_start()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1409" y="141" width="70" height="35" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-22" value="stm32_spidev_initialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-741" y="224" width="145" height="32.5" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-25" value="stm32_usbinitialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-279" y="224" width="120" height="32.5" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-27" value="stm32_netinitialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-582" y="224" width="120" height="32.5" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-30" value="board_autoled_initialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-442" y="224" width="145" height="32.5" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-36" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-33" target="A2ZbU5LwQxJ9MIYdX8El-35">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-33" value="nx_bringup()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1360" y="226.5" width="120" height="31" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-39" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-35" target="A2ZbU5LwQxJ9MIYdX8El-38">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-35" value="nx_start_application()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1367.5" y="296.5" width="135" height="32.5" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-54" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-38" target="A2ZbU5LwQxJ9MIYdX8El-53">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-38" value="board_late_initialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1368.75" y="366.5" width="137.5" height="33.75" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-40" value="drivers_initialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1494" y="227.5" width="107" height="30" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-46" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-5" target="A2ZbU5LwQxJ9MIYdX8El-11">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="-1889" y="44" as="sourcePoint" />
            <mxPoint x="-1930" y="219" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-11" value="stm32_lowsetup()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1308" y="141" width="110" height="35" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-50" value="up_initialize()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1609" y="226.5" width="95" height="30" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-53" value="stm32_bringup()" style="whiteSpace=wrap;html=1;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="-1360" y="435" width="121" height="31.88" as="geometry" />
        </mxCell>
        <mxCell id="A2ZbU5LwQxJ9MIYdX8El-51" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" edge="1" parent="1" source="A2ZbU5LwQxJ9MIYdX8El-20" target="A2ZbU5LwQxJ9MIYdX8El-50">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
